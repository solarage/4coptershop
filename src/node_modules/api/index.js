import { getObjInArrById } from 'helpers/helpers';

const quadcoptersUrl = 'https://5b8da1105722ac001431745b.mockapi.io/api/v1/quadcopters';
const categoriesUrl = 'https://5b8da1105722ac001431745b.mockapi.io/api/v1/categories';

export const fetchQuadcopters = async () => {

    let status = (response) => {
        if(response.status !== 200) {
            return Promise.reject(new Error(response.stats.text))
        }
        return Promise.resolve(response)
    };

    let json = (response) => response.json();

    return new Promise( resolve => {

        fetch(quadcoptersUrl)
            .then(status)
            .then(json)
            .then((data) => {
                resolve(data[0].quadcopters);
            })
            .catch((error) => {
                console.log('Error', error)
            })
    }) 
};

export const loadMoreQuadcopters = async ({ offset }) => {

    let status = (response) => {
        if(response.status !== 200) {
            return Promise.reject(new Error(response.stats.text))
        }
        return Promise.resolve(response)
    };

    let json = (response) => response.json();

    return new Promise( resolve => {

        fetch(quadcoptersUrl)
            .then(status)
            .then(json)
            .then((data) => {
                resolve(data[0].quadcopters);
            })
            .catch((error) => {
                console.log('Error', error)
            })       
    }) 
};

export const fetchQuadcopterById = async id => {

    let status = (response) => {
        if(response.status !== 200) {
            return Promise.reject(new Error(response.stats.text))
        }
        return Promise.resolve(response)
    };

    let json = (response) => response.json();

    return new Promise( resolve => {

        fetch(quadcoptersUrl)
            .then(status)
            .then(json)
            .then((data) => {
                const quadcopter = getObjInArrById(id, data[0].quadcopters);

                resolve(quadcopter);
            })
            .catch((error) => {
                console.log('Error', error)
            })      
    }) 
};

export const fetchCategories = async() => {

    let status = (response) => {
        if(response.status !== 200) {
            return Promise.reject(new Error(response.stats.text))
        }
        return Promise.resolve(response)
    };

    let json = (response) => response.json();

    return new Promise( resolve => {

        fetch(categoriesUrl)
            .then(status)
            .then(json)
            .then((data) => {
                resolve(data[0].categories);
            })
            .catch((error) => {
                console.log('Error', error)
            })       
    }) 
};